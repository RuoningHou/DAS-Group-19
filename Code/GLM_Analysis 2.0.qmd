# Load Packages
```{r}
install.packages("tidyverse")
install.packages("moderndive")
install.packages("gapminder")
install.packages("sjPlot")
install.packages("stats")
install.packages("jtools")
install.packages("ggplot2")
install.packages("nnet")

library(tidyverse)
library(moderndive)
library(gapminder)
library(sjPlot)
library(stats)
library(jtools)
library(ggplot2)
library(nnet)
```

# Load Data
```{r}
data <- read.csv("dataset19_cleaned.csv")

# Select relevant columns
evals.data <- data %>%
  select(animal_type, intake_type, outcome_type, chip_status, time_at_shelter)

# Display summary of the dataset
summary(evals.data)
```

**Dataset Summary:**  
- The dataset contains key variables related to animals in a shelter, including the type of animal, the method of intake, the outcome type, and whether the animal is chipped.  
- The `time_at_shelter` variable represents how long each animal stays in the shelter, which is our primary dependent variable.

# Data Visualization

## Boxplot of Time at Shelter by Animal Type
```{r}
ggplot(data = evals.data, aes(x = animal_type, y = time_at_shelter, fill = animal_type)) +
  geom_boxplot() +
  labs(x = "Animal Type", y = "Time at Shelter") +
  theme(legend.position = "none")
```

**Analysis:**  
- Dogs tend to stay longer in the shelter compared to cats and other animals.  
- The distribution of stay time varies across different animal types, suggesting the need for further statistical analysis.

# GLM Analysis

## Poisson Regression Model
```{r}
model.full <- glm(time_at_shelter ~ animal_type + intake_type + outcome_type + chip_status,
                  data = data,
                  family = poisson())
summary(model.full)
```

**Regression Results Interpretation:**  
- **Intercept = 3.2053** (p < 0.001), representing the baseline category (e.g., CAT).  
- **DOG Coefficient = 0.1606** (p < 0.001), meaning dogs stay **17.4% longer** than cats (`exp(0.1606) ≈ 1.174`).  
- **OWNER SURRENDER = -1.4761** (p < 0.001), indicating surrendered animals stay much shorter (`exp(-1.4761) ≈ 0.229`).  
- **EUTHANIZED = -0.6564** (p < 0.001), meaning euthanized animals stay **48.1% shorter** (`exp(-0.6564) ≈ 0.519`).  

# Checking Overdispersion
```{r}
dispersion <- deviance(model.full) / df.residual(model.full)
dispersion
```

**Overdispersion Analysis:**  
- If `dispersion > 1`, the data exhibits overdispersion, requiring `Quasi-Poisson` or **Negative Binomial Regression**.

# Quasi-Poisson Adjustment
```{r}
model.quasi <- glm(time_at_shelter ~ animal_type + intake_type + outcome_type + chip_status,
                   data = data, 
                   family = quasipoisson())
summary(model.quasi)
```

**Quasi-Poisson Interpretation:**  
- The adjusted model accounts for overdispersion while keeping the overall significance and effect directions unchanged.

# Predicted vs Observed Values
```{r}
data$predicted_time <- predict(model.full, type = "response")
head(data[, c("time_at_shelter", "predicted_time")])
```

**Prediction Analysis:**  
- The predicted values are generally close to the observed values, but some variation exists.

## Scatter Plot: Observed vs Predicted Values
```{r}
plot(data$time_at_shelter, data$predicted_time,
     xlab = "Observed", ylab = "Predicted",
     main = "Observed vs Predicted Time at Shelter")
abline(0, 1, col = "red", lwd = 2)
```

**Graph Interpretation:**  
- Ideally, points should be **aligned along the red diagonal**, indicating a well-fitted model.  
- However, some scatter is present, suggesting possible underestimation or overestimation for specific categories.

# Model Evaluation

## AIC and BIC Comparison
```{r}
AIC(model.full)
BIC(model.full)
```

**AIC/BIC Analysis:**  
- **AIC = 7592.7**, **BIC = 10003** (lower values indicate a better model).  
- These values suggest the model performs well but can be optimized.

# Conclusion
1. **Dogs tend to stay longer than cats, while other animals have shorter stay durations.**  
2. **Owner-surrendered and returned-to-owner animals have significantly shorter shelter times.**  
3. **Poisson regression may have overdispersion issues**, requiring **Quasi-Poisson** adjustments.  
4. **Further optimization ideas:**  
   - **Adding interaction terms** (e.g., `animal_type * intake_type`).  
   - **Testing Negative Binomial regression** to handle overdispersion.  
   - **Analyzing residuals** for potential systematic errors.
